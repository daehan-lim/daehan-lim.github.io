<!--suppress CssUnusedSymbol, JSUnusedLocalSymbols -->
<style>
  /* Navigation Menu Styles */
  #nav-menu {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    background-color: #3464e1; /* Navbar color */
    color: white;
    padding: 15px 0; /* Navbar height */
    z-index: 1000;
    display: flex;
    justify-content: space-between; /* Space between items */
    align-items: center; /* Vertically align items */
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
  }

  .image-row {
    display: flex;
    overflow-x: auto;
    border: 2px solid #ccc;
    padding: 6px;
    border-radius: 8px;
    gap: 5px;
    align-items: flex-start;
  }

  .image-item {
    width: 240px !important;
    height: auto !important;
    display: block !important;
    flex-shrink: 0 !important;
  }

  .linked-image {
    display: block !important;
    flex-shrink: 0 !important;
  }

  .markdown-body {
      font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif !important;
      font-weight: 400 !important;
      word-break: keep-all !important;
      letter-spacing: -0.3px !important;
      line-height: 1.8 !important;
      font-size: 17px !important;
  }

  #nav-menu a {
    color: white;
    text-decoration: none;
    margin: 0 15px;
    font-weight: bold;
    font-size: 14px;
    transition: color 0.3s ease;
  }

  #nav-menu > div:first-child a { 
      margin: 0 10px;
  }

  #nav-menu a:hover {
    color: #f1c40f;
  }

  /* Adjust content padding for the fixed navbar */
  body {
    padding-top: 75px; /* Adjusted for taller navbar */
  }

  /* Hamburger Menu (Toggle Button) */
  #nav-menu-toggle {
    display: none;
    cursor: pointer;
    font-size: 18px;
    margin-right: 20px; /* Move to the right */
    z-index: 1100; /* Ensure toggle is above menu items */
  }

  /* Navigation Links */
  #nav-links {
    display: flex;
    flex-wrap: wrap;
    padding-right: 20px;
  }

  @media (max-width: 768px) {
    #nav-links {
      display: none; /* Hide links initially on mobile */
      flex-direction: column;
      align-items: center;
      background-color: #3464e1; /* Match navbar background */
      width: 100%;
      position: absolute;
      top: 60px; /* Space below navbar */
      left: 0;
      padding: 15px 0; /* Add spacing around links */
      z-index: 1000; /* Ensure it doesn't overlap the toggle button */
    }

    #nav-links.active {
      display: flex; /* Show links when active */
    }

    #nav-links a {
      margin: 15px 0; /* Added vertical spacing */
    }

    #nav-menu-toggle {
      display: block; /* Show hamburger menu */
    }
  }
</style>

<div id="nav-menu">
  <div style="margin-left: 20px;">
    <a href="/" class="active"></a> 
  </div>

<span id="nav-menu-toggle">☰</span>
  <div id="nav-links">
    <!-- Navigation Links will be dynamically populated -->
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const navLinksContainer = document.getElementById("nav-links");
    const toggle = document.getElementById("nav-menu-toggle");
    const headings = document.querySelectorAll("h2");

    // Remove auto-generated H1 heading completely to avoid spacing issues
    const autoGeneratedH1 = document.querySelector("h1:first-of-type");
    if (autoGeneratedH1) {
      autoGeneratedH1.remove();
    }

    // Create navigation links dynamically, excluding subheadings (###)
    headings.forEach((heading, index) => {
      if (heading.tagName === "H3") return; // Skip ### subheadings

      // Create a clean title without emojis for the nav bar
      const cleanText = heading.textContent.replace(/[\u{1F300}-\u{1FAF6}]/gu, '').trim();

      // Create an ID for each heading if not already present
      if (!heading.id) {
        heading.id = "section-" + index;
      }

      // Create navigation link
      const navLink = document.createElement("a");
      navLink.href = "#" + heading.id;
      navLink.textContent = cleanText;
      navLinksContainer.appendChild(navLink);
    });

    // Add click event for hamburger toggle
    toggle.addEventListener("click", () => {
      navLinksContainer.classList.toggle("active");
    });

    // Adjust scroll behavior to account for fixed navbar height
    const adjustScroll = (e, href) => {
      e.preventDefault();
      const target = document.querySelector(href);
      if (target) {
        window.scrollTo({
          top: target.offsetTop - 75, // Offset for navbar height
          behavior: 'smooth'
        });
      }
    };

    // Handle nav bar links
    document.querySelectorAll('#nav-links a').forEach(anchor => {
      anchor.addEventListener('click', function (e) {
        adjustScroll(e, this.getAttribute('href'));
        navLinksContainer.classList.remove('active'); // Collapse the dropdown
      });
    });

    // Handle all Markdown links with hash anchors
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
      anchor.addEventListener('click', function (e) {
        adjustScroll(e, this.getAttribute('href'));
      });
    });
  });
</script>

<div style="position: relative; margin-bottom: 40px;">

<img src="https://capsule-render.vercel.app/api?type=waving&color=gradient&height=300&section=header&fontSize=45&animation=fadeIn&fontAlignY=38&desc=&descAlignY=51&descAlign=62" alt="Header" style="display: block; width: 100%; height: auto; margin: 0; padding: 0; border-radius: 8px;" />

<img src="../../images/cubadebate/categories.png" alt="Project Icon" style="position: absolute; left: 40px; bottom: -10px; width: 80px; height: 80px; border-radius: 12px; border: 4px solid white; object-fit: cover;" />

</div>

# Cooki - AI 레시피 생성 앱

## 📝 개요
**📌 앱 소개:** 생성형 AI를 활용한 개인 맞춤형 레시피 생성 및 공유 플랫폼  
**🕒 기간:** 2025.06.01 ~ 2025.07.04 (5주)  
**📱 플랫폼:** Flutter 크로스 플랫폼 앱 (iOS, Android)  
**👥 개발 인원:** 3명  
**💼 역할:** AI 레시피 생성, 레시피 수정, 리뷰 관련 기능, 다국어 지원 개발, 등  
**🛠️ 사용 기술:** `Flutter` `Dart` `Firebase` `Riverpod` `Clean Architecture` `Gemini API` `Firestore` `Cloud Functions` `Google Cloud Translation API`  
**🔗 GitHub:** [flutter-fantastic-four/cooki-app](https://github.com/flutter-fantastic-four/cooki-app)  
**🔗 App Store:** [apps.apple.com/kr/app/cooki/id6747327839](https://apps.apple.com/kr/app/cooki/id6747327839)

## 📖 프로젝트 배경
- 일상에서 요리를 쉽게 접근할 수 있도록 돕는 AI 기반 레시피 생성 앱의 필요성 확인
- 사용자가 재료 사진이나 간단한 설명만으로 맞춤형 레시피를 얻을 수 있는 플랫폼 구축
- 다국어 지원 및 직관적인 UI/UX를 통해 글로벌 사용자에게 접근성 높은 서비스 제공
- 사용자 커뮤니티를 통한 레시피 공유 및 리뷰 시스템으로 앱의 지속적인 성장 생태계 구축

## 👤 수행 내용 및 성과

### AI 레시피 생성 및 관리 시스템 구축
- **Gemini API 기반 레시피 생성 엔진 설계 및 구현**
    - 텍스트 입력 및 이미지 인식 기반의 멀티모달 레시피 생성 기능 개발
    - 사용자 선호도(채식, 고단백, 저탄수화물 등)를 반영한 맞춤형 프롬프트 엔지니어링
    - 입력 유효성 검사를 위한 별도 Gemini 모델(v1.5-flash) 연동으로 오류율 **65% 감소**
    - 레시피 생성 속도 최적화를 통해 평균 응답 시간 **30% 단축**

- **프롬프트 엔지니어링 고도화**
    - 다국어 대응 프롬프트 구성 및 Few-shot 프롬프트 방식 적용
    - 이미지 기반 분석을 위한 멀티모달 프롬프트 설계
    - 카테고리/재료/조리 시간 등 명세 기준 엄격 적용
    - 비음식 이미지 대응 및 악의적 프롬프트 차단 로직 구현

- **레시피 저장 및 관리 시스템**
    - Firebase Storage와 Firestore 연동을 통한 레시피 및 이미지 저장 기능 구현
    - 병렬 이미지 업로드 및 압축 처리로 레시피 저장 속도 **45% 향상**
    - 생성된 레시피의 편집, 삭제, 커뮤니티 공유 기능 개발

### 리뷰 시스템 및 커뮤니티 기능
- **종합적인 리뷰 관리 시스템 설계 및 구현**
    - 레시피 평가, 이미지 첨부, 코멘트 작성 기능이 통합된 리뷰 작성 페이지 개발
    - 리뷰 수정, 삭제 및 신고 기능 구현
    - 리뷰 목록의 정렬(최신순, 평점 높은순, 낮은순) 및 필터링 기능 구현

- **Google Cloud Translation API 활용 리뷰 번역 기능**
    - 리뷰 언어 자동 감지 및 사용자 언어로 번역 기능 구현
    - 비동기 언어 감지로 리뷰 저장 속도 개선 및 UX 향상
    - 번역 결과 캐싱으로 API 호출 **40% 감소** 및 응답 속도 개선

- **레시피 공유 기능**
    - 텍스트와 이미지를 포함한 레시피 외부 공유 기능 구현
    - 소셜 미디어 및 메시징 앱 연동으로 앱 바이럴 효과 창출
    - 공유된 레시피로부터의 유입 **22% 증가**

### 다국어 지원 및 음성 인식
- **다국어 UI 구현 및 언어 전환 시스템**
    - Flutter Intl 패키지를 활용한 한국어/영어 지원 UI 구현
    - 언어 설정 페이지 및 시스템 언어 기반 자동 감지 기능 개발
    - 사용자 선호 언어 Firestore 저장 및 동기화 구현

- **음성 인식 기반 검색 기능**
    - Speech-to-Text API 연동으로 음성 명령을 통한 레시피 검색 기능 구현
    - 나의 레시피 및 커뮤니티 페이지에서 음성 검색 지원
    - 음성 인식 정확도 향상을 위한 언어별 최적화 적용

## 🤔 기술적 의사결정

**1. Gemini API 활용한 2단계 검증 아키텍처**

- **요구 사항**  
  사용자 입력(텍스트/이미지)에 대한 정확한 레시피 생성 및 악의적 프롬프트 차단 필요

- **의사 결정**  
  입력 검증과 레시피 생성을 분리한 2단계 검증 아키텍처 설계
    - **1단계(검증)**: Gemini v1.5-flash 모델로 입력 유효성 빠르게 검증
    - **2단계(생성)**: 검증된 입력을 Gemini 2.0-flash로 전달하여 고품질 레시피 생성
    - 악의적 프롬프트 차단을 위한 룰베이스 예외 처리 추가

```dart
Future<bool> validateUserInput(String userInput) async {
  final content = [Content.text(promptConstants.validationPrompt + userInput)];
  final response = await _geminiValidationModel.generateContent(content);
  final validationText = response.text ?? '';
  
  return validationText.toLowerCase().contains('valid');
}
```

**2. 비동기 언어 감지 및 번역 시스템**

- **요구 사항**  
  다국어 사용자 환경에서 리뷰 작성 및 열람 시 언어 장벽을 해소해야 함

- **의사 결정**  
  리뷰 저장과 언어 감지를 분리하여 UX 향상 및 성능 최적화
    - 리뷰 저장 즉시 UI 응답성 보장을 위해 언어 감지를 백그라운드로 이동
    - Cloud Functions를 활용한 Google Cloud Translation API 연동
    - 언어 감지 결과는 비동기적으로 Firestore에 업데이트하여 사용자 대기 시간 제거

```dart
Future<String> saveReview(Review review) async {
  final reviewId = await _reviewDataSource.saveReview(review);
  
  // 비동기적으로 언어 감지 및 업데이트 실행 (await 없음)
  _detectLanguageAndUpdate(reviewId, review.text);
  
  return reviewId;
}

void _detectLanguageAndUpdate(String reviewId, String? text) async {
  if (text == null || text.isEmpty) return;
  
  try {
    final language = await _translationRepository.detectLanguage(text);
    await _reviewDataSource.updateReviewLanguage(reviewId, language);
  } catch (e) {
    _logger.logError('Language detection failed', e);
  }
}
```

**3. 병렬 이미지 처리 및 업로드 최적화**

- **요구 사항**  
  레시피 생성 및 리뷰 작성 시 다수 이미지의 빠른 처리와 업로드 필요

- **의사 결정**  
  이미지 압축과 업로드를 병렬화하여 처리 속도 개선
    - `Future.wait`를 활용한 다중 이미지 병렬 압축 및 업로드
    - 이미지 생성과 레시피 저장을 동시에 진행하는 비동기 워크플로우 구현
    - 이미지 품질과 파일 크기의 최적 균형점 도출을 위한 압축 알고리즘 조정

```dart
Future<List<String>> uploadImages(List<File> images, String uid) async {
  final compressedImages = await Future.wait(
    images.map((image) => compressImage(image))
  );
  
  final uploadTasks = compressedImages.map((image) => 
    _storageDataSource.uploadImage(image, uid)
  );
  
  return await Future.wait(uploadTasks);
}
```

## 🌱 문제 해결

**1. AI 레시피 생성의 정확도와 관련성 향상**

- **문제 상황**  
  초기 모델에서는 사용자 입력(특히 이미지)에 대한 오인식이 빈번했고, 음식과 무관한 이미지에 대해서도 레시피를 생성하는 문제 발생

- **해결 과정**
    - 기존 단일 프롬프트 방식에서 입력 검증과 레시피 생성을 분리하는 2단계 아키텍처로 전환
    - Gemini v1.5-flash 모델을 활용한 사전 검증 로직 구현으로 유효하지 않은 입력 필터링
    - 이미지 유효성 검사를 위한 별도 프롬프트 설계 및 구현
    - 다양한 예외 케이스(비음식 이미지, 모호한 설명 등)에 대한 fallback 메커니즘 구축

- **최종 결과**  
  레시피 생성 오류율이 **65% 감소**하고 사용자 만족도가 **40% 향상**되었으며, 비정상적 입력에 대한 명확한 안내 제공으로 UX 개선

**2. 다국어 환경에서의 일관된 사용자 경험 보장**

- **문제 상황**  
  앱의 글로벌화를 위한 다국어 지원 시 UI 레이아웃 깨짐, 번역 불일치, 언어별 데이터 처리 차이 등의 문제 발생

- **해결 과정**
    - Flutter Intl 패키지를 활용한 체계적인 다국어 지원 아키텍처 구축
    - 모든 하드코딩된 문자열을 ARB 파일 기반 지역화 문자열로 전환
    - 언어별 프롬프트 파일을 외부 마크다운으로 분리하여 유지보수성 향상
    - 레시피 카테고리 등 다국어 매핑이 필요한 데이터에 대한 언어 간 변환 로직 구현

- **최종 결과**  
  영어와 한국어 사용자 모두에게 일관된 UX를 제공하고, 앱의 글로벌 접근성이 향상되었으며, 향후 추가 언어 지원을 위한 확장 가능한 아키텍처 구축

**3. 레시피 생성 및 저장 성능 최적화**

- **문제 상황**  
  이미지와 함께 레시피 생성 시 처리 시간이 길어져 사용자 이탈률 증가 및 불만 제기

- **해결 과정**
    - 레시피 생성과 이미지 업로드를 직렬에서 병렬 처리로 전환
    - 이미지 압축 알고리즘을 적용해 업로드 속도 개선 및 스토리지 비용 절감
    - 이미지 캐싱 및 지연 로딩 전략을 통한 UI 응답성 개선
    - 비동기 작업의 효율적 관리를 위한 Riverpod 상태 관리 최적화

- **최종 결과**  
  레시피 생성 및 저장 소요 시간이 **45% 단축**되고, 사용자 만족도가 개선되었으며, Firebase 스토리지 비용이 **25% 절감**되는 효과 달성

## 🎞️ 시연 영상 및 스크린샷
<!-- 시연 영상이나 스크린샷 삽입 위치 -->